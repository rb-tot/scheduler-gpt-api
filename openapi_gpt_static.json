{
  "openapi": "3.1.1",
  "info": { "title": "SchedulerGPT API", "version": "gpt-static-1" },
  "servers": [ { "url": "https://scheduler-gpt-api.onrender.com" } ],
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": { "type": "apiKey", "in": "header", "name": "X-API-Key" }
    },
    "schemas": {
      "ScheduleRequest": {
        "type": "object",
        "properties": {
          "tech_id": { "type": "integer" },
          "start_date": { "type": "string", "format": "date" },
          "assigned_clusters": { "type": "array", "items": { "type": "integer" } },
          "priority_work_orders": { "type": "array", "items": { "type": "integer" } },
          "horizon_days": { "type": "integer" },
          "target_sow_list": { "type": "array", "items": { "type": "string" } },
          "anchor_week_strategy": { "type": "string" },
          "allow_in_day_filler": { "type": "boolean" },
          "fixed_jobs": { "type": "array", "items": { "type": "object" } },
          "weekly_target_hours_min": { "type": "integer" },
          "weekly_target_hours_max": { "type": "integer" },
          "max_drive_minutes": { "type": "integer" },
          "pre_night_day_job_cap": { "type": "integer" },
          "radius_miles_cap": { "type": "integer" },
          "seed_region": { "type": "string" },
          "seed_cluster": { "type": "integer" }
        },
        "required": ["tech_id", "start_date"]
      }
    }
  },
  "security": [ { "ApiKeyAuth": [] } ],
  "paths": {
    "/health": {
      "get": {
        "operationId": "health",
        "summary": "Health check",
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/schedule/preview": {
      "post": {
        "operationId": "schedule_preview",
        "summary": "Build a 1-week schedule without saving",
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ScheduleRequest" } } }
        },
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/schedule/commit": {
      "post": {
        "operationId": "schedule_commit",
        "summary": "Build and save a 1-week schedule",
        "requestBody": {
          "required": true,
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ScheduleRequest" } } }
        },
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/jobs/search": {
      "get": {
        "operationId": "jobs_search",
        "summary": "Search unscheduled jobs",
        "parameters": [
          { "in": "query", "name": "region", "schema": { "type": "string" } },
          { "in": "query", "name": "sow", "schema": { "type": "string" } },
          { "in": "query", "name": "horizon_days", "schema": { "type": "integer" } },
          { "in": "query", "name": "tech_id", "schema": { "type": "integer" } },
          { "in": "query", "name": "radius_miles", "schema": { "type": "number" } }
        ],
        "responses": { "200": { "description": "OK" } }
      }
    }
  }
}
