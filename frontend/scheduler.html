<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Job Scheduler</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="/static/scheduler.css">
</head>
<body>
    <!-- HEADER -->
    <header class="app-header">
        <h1>üóìÔ∏è Job Scheduler</h1>
        <div class="header-controls">
            <button id="refresh-btn" class="btn-primary">üîÑ Refresh Data</button>
            <button id="bulk-assign-btn" class="btn-warning">‚ö° Bulk Assign</button>
            <button id="export-btn" class="btn-secondary">üì• Export</button>
        </div>
    </header>

    <!-- MAP (Full Width Top) -->
    <section class="map-section">
        <div id="map"></div>
        <div class="map-controls">
            <button id="show-all-jobs" class="btn-sm btn-primary">Show All Jobs</button>
            <button id="show-techs" class="btn-sm btn-secondary">Show Techs</button>
            <button id="cluster-view" class="btn-sm btn-info">Toggle Clusters</button>
        </div>
    </section>

    <!-- BOTTOM 3-PANEL SPLIT -->
    <section class="workspace">
        
        <!-- LEFT PANEL: Job Pool -->
        <div class="panel panel-jobs">
            <div class="panel-header">
                <h2>üìã Job Pool</h2>
                <div class="job-stats">
                    <span id="job-count">0 jobs</span>
                    <span id="total-hours">0 hrs</span>
                </div>
            </div>
            
            <div class="panel-filters">
                <input type="text" id="job-search" placeholder="Search jobs..." class="filter-input">
                <select id="filter-region" class="filter-select">
                    <option value="">All Regions</option>
                    <option value="CO">Colorado</option>
                    <option value="UT">Utah</option>
                    <option value="AZ">Arizona</option>
                </select>
                <select id="filter-priority" class="filter-select">
                    <option value="">All Priorities</option>
                    <option value="NOV">NOV/Urgent</option>
                    <option value="Monthly O&M">Monthly O&M</option>
                    <option value="Annual">Annual</option>
                </select>
                <select id="filter-urgency" class="filter-select">
                    <option value="">All Urgency</option>
                    <option value="critical">Critical (&lt;7 days)</option>
                    <option value="high">High (&lt;14 days)</option>
                    <option value="normal">Normal</option>
                </select>
            </div>

            <div id="job-list" class="job-list">
                <div class="loading">Loading jobs...</div>
            </div>
        </div>

        <!-- CENTER PANEL: Schedule Calendar -->
        <div class="panel panel-schedule">
            <div class="panel-header">
                <h2>üìÖ Schedule</h2>
                <div class="calendar-nav">
                    <button id="prev-week" class="btn-nav">‚óÄ</button>
                    <span id="week-display">Select a tech</span>
                    <button id="next-week" class="btn-nav">‚ñ∂</button>
                </div>
            </div>

            <div class="tech-selector">
                <label>Technician:</label>
                <select id="tech-select" class="tech-select">
                    <option value="">Select technician...</option>
                </select>
                <span id="tech-capacity" class="capacity-badge">0/40 hrs</span>
            </div>

            <div id="calendar-view" class="calendar-grid">
                <div class="calendar-placeholder">
                    Select a technician to view their schedule
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL: Tech Roster -->
        <div class="panel panel-techs">
            <div class="panel-header">
                <h2>üë∑ Technicians</h2>
                <button id="filter-available-only" class="btn-sm">Available Only</button>
            </div>

            <div id="tech-list" class="tech-list">
                <div class="loading">Loading technicians...</div>
            </div>
        </div>

    </section>

    <!-- MODALS -->
    
    <!-- Job Details Modal -->
    <div id="job-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Job Details</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="job-details">
                <!-- Filled by JS -->
            </div>
            <div class="modal-footer">
                <button id="assign-job-btn" class="btn-primary">Assign to Tech</button>
                <button id="view-on-map-btn" class="btn-secondary">View on Map</button>
            </div>
        </div>
    </div>

    <!-- Assignment Modal -->
    <div id="assign-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Assign Job</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="assign-job-info"></div>
                <div class="form-group">
                    <label>Technician:</label>
                    <select id="assign-tech-select" class="form-control">
                        <!-- Filled by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Date:</label>
                    <input type="date" id="assign-date" class="form-control">
                </div>
                <div class="form-group">
                    <label>Start Time:</label>
                    <input type="time" id="assign-time" class="form-control" value="09:00">
                </div>
                <div id="validation-warnings" class="warnings"></div>
            </div>
            <div class="modal-footer">
                <button id="confirm-assign-btn" class="btn-primary">Confirm Assignment</button>
                <button class="close-modal btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Suggestions Modal -->
    <div id="suggestions-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üí° Smart Suggestions</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="suggestions-list">
                <!-- Filled by JS -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/static/scheduler.js"></script>
</body>
</html>
